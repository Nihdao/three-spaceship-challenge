# Retrospective — Epic 5: Dash & Planet Exploration (Tier 2)

**Date:** 2026-02-11
**Facilitator:** Bob (Scrum Master)
**Epic Status:** Complete (3/3 stories done)
**Participants:** Adam (Project Lead), Alice (Product Owner), Bob (Scrum Master), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

## Epic 5 Summary

### Delivery Metrics

- Stories Completed: 3/3 (100%)
- Stories Originally Planned: 3 — No mid-epic scope additions (4th consecutive zero-scope-creep epic)
- Code Reviews Completed: 3/3
- Test Coverage: 353 → 403 tests (+50 new, 0 regressions)
- Production Incidents: 0
- Regressions: 0
- Code Review Issues: 8 total fixes applied (2 HIGH in 5.3, 1 MEDIUM bug in 5.1, 1 MEDIUM bug in 5.3, plus documentation/cleanup)

### Stories Delivered

| Story | Title | Key Outcome |
|-------|-------|-------------|
| 5.1 | Dash / Barrel Roll | isDashing/dashTimer/dashCooldownTimer in usePlayer, barrel roll animation in PlayerShip, magenta trail, HUD cooldown indicator, edge-detected input in GameLoop. 366 tests |
| 5.2 | Planet Placement & Rendering | planetDefs.js (3 tiers), initializePlanets() in useLevel, PlanetRenderer with GLB models + emissive glow + idle rotation, minimap with player/planet dots. 383 tests |
| 5.3 | Planet Scanning & Rewards | scanningTick() distance-based scanning, generatePlanetReward() tier-filtered choices, PlanetRewardModal, scan progress HUD bar, planetReward game phase. 403 tests |

### Code Review Summary

| Story | Issues Found | Key Findings |
|-------|-------------|--------------|
| 5.1 | 1H (git hygiene), 2M (emissive restore, trail rotation bug), 1L | M2: Trail mesh rotated with barrel roll — moved from bankRef to groupRef |
| 5.2 | 4 fixes | Material clone for shared mutation prevention, scanRadius field, placement warning, Y offset tuning |
| 5.3 | 2H, 4M, 2L | H1: DRY violation (buildFullPool extracted), H2: rewardTier residual, M3: zone-switching scanProgress not reset, M4: dead code removed |

## What Went Well

1. **Rapid and efficient delivery** — Adam's assessment. 3 stories, zero blockers, zero scope creep. Fourth consecutive epic with no scope additions.

2. **Pattern reuse as velocity multiplier** — PlanetRewardModal reused the LevelUpModal pattern seamlessly. `generatePlanetReward()` leveraged existing `generateChoices()` infrastructure. The `buildFullPool()` extraction during code review actually improved the existing codebase (DRY).

3. **Architecture stability** — Two entirely new Tier 2 mechanics (dash + planet exploration) integrated without any structural modifications. The 6-layer architecture, Zustand store patterns, and GameLoop tick order absorbed everything naturally.

4. **Increasing code quality across stories** — Story 5.1 had debug issues (reset pollution, leftover delta). Story 5.2 was clean — zero debug required. Story 5.3 was clean at implementation, bugs caught only in code review. Clear learning curve within the epic.

5. **Code reviews catching real bugs** — 3 functional bugs caught: trail rotation (5.1), zone-switching scanProgress (5.3), rewardTier residual state (5.3). Process is proven and reliable.

6. **Test discipline maintained** — 50 new tests added, zero regressions. Every story maintained the green test suite.

## Challenges

1. **State reset remains a systemic recurring problem** — 3rd consecutive epic with reset-related bugs. Story 5.1: `reset()` missing dash fields caused test pollution. Story 5.3: `rewardTier` not cleared in `resumeGameplay()`, zone-switching `scanProgress` not reset. The manual process of remembering to add new fields to `reset()` is fundamentally fragile.

2. **Bugfix `4-7` (enemy reset on retry) still in backlog** — Committed to in Epic 4 retrospective, not addressed during Epic 5. Two epics carrying this debt. Prioritized for resolution before Epic 6.

3. **SFX audio files still placeholder-missing** — All SFX entries (including new dash-whoosh, dash-ready, scan-start, scan-complete) are registered but audio files don't exist. audioManager handles gracefully with console.warn. Functional but incomplete experience.

4. **No integration tests** — All 403 tests are unit tests. Cross-system interactions (phase transitions, scan→reward→resume flow) only validated via code review and manual testing.

## Previous Retro (Epic 4) Follow-Through

| # | Action Item | Status | Evidence |
|---|-------------|--------|----------|
| 1 | Corrective story: Reset enemies on retry | ❌ Not Addressed | `4-7-bugfix-reset-enemies-on-retry` still in backlog |
| 2 | Commit all Epic 4 work | ✅ Complete | Commit `ac05a23` covers Epic 4 + early Epic 5 |
| 3 | Reset checklist pattern in code | ⏳ Partial | All `reset()` functions include fields, but no automated verification or formal checklist comment |
| 4 | Accept integration tests as Tier 2 scope | ✅ Accepted | Unit tests only, acknowledged |
| 5 | Accept SFX assets and HUD polish as Tier 2 scope | ✅ Accepted | SFX still placeholder, approach maintained |

**Assessment:** 2/5 fully completed, 1 partial, 1 not addressed, 1 accepted. The enemy reset bugfix was the most important action item and was not done. This is now prioritized as a blocking prerequisite for Epic 6.

**Key learning:** Verbal commitments without enforcement mechanisms get dropped. The team needs automated safeguards (tests) not process reminders.

## Key Insights

1. **State reset is a systemic problem requiring a systemic solution** — Manual `reset()` maintenance has failed across 3 epics. Solution: automated tests per store that compare post-reset state with initial state. Any new field not included in `reset()` breaks the test automatically.

2. **Pattern reuse remains the strongest velocity multiplier** — Established patterns (LevelUpModal, generateChoices, timer decay, SFX edge detection) allow new features to be built rapidly with confidence.

3. **Code reviews are the last safety net and they work** — 3 real bugs caught across 3 reviews. The investment in thorough reviews pays off consistently.

4. **Zero-scope-creep discipline compounds** — 4 consecutive epics delivered exactly as planned. This predictability enables confident planning for future epics.

5. **Verbal action items decay without enforcement** — The `4-7` bugfix was committed to in Epic 4's retro but never prioritized. Action items need concrete ownership and blocking status to be executed.

## Technical Debt

| Item | Severity | Impact on Epic 6 | Action |
|------|----------|-------------------|--------|
| Enemy state not reset on retry (`4-7`) | HIGH | Wormhole shockwave (6.1) clears all enemies — fragile if reset is bugged | Fix before Epic 6 (BLOCKING) |
| No automated reset() tests | MEDIUM | New boss/wormhole state fields will need resets | Add before Epic 6 |
| SFX audio files missing | LOW | No gameplay impact, audioManager handles gracefully | Source when audio polish becomes priority |
| No integration tests | LOW | Boss phase transitions are complex — higher risk | Accepted as Tier 2 scope |

## Action Items

### Process Improvements

| # | Action | Owner | Success Criteria |
|---|--------|-------|------------------|
| 1 | Fix `4-7-bugfix-reset-enemies-on-retry` | Dev agent | Game restarts with clean state — 0 leftover entities, spawner reinitialized |
| 2 | Automated `reset()` coverage tests for every Zustand store | Dev agent | Each store has a test comparing post-reset state with initial state. New fields missing from reset() break the test |

### Team Agreements

- Every new field added to a Zustand store MUST be covered by the automated reset test
- `reset()` = exact copy of initial state — no partial resets
- Bugfix `4-7` is a BLOCKING prerequisite before Epic 6 starts
- Verbal retro commitments need concrete enforcement (tests, blocking status) to be reliable

## Significant Discoveries

No significant discoveries that would change Epic 6's plan. The architecture holds, all dependencies are met, and the plan remains valid.

## Epic 6 Readiness Assessment

### Dependencies on Epic 5 — All Met

- ✅ Dash mechanic (invulnerability, barrel roll, cooldown) — fully functional
- ✅ Planet system (placement, rendering, scanning, rewards) — fully functional
- ✅ Phase transition patterns (gameplay → planetReward → gameplay) — proven
- ✅ Audio system with SFX edge detection — ready for boss music/SFX
- ✅ Visual feedback (camera shake, damage flash) — ready for boss encounters
- ✅ 403 tests passing, zero regressions

### Preparation Needed (Critical)

- **Fix `4-7` enemy reset on retry** — BLOCKING. Wormhole shockwave in 6.1 depends on clean enemy state management
- **Automated reset() tests** — Safety net for Epic 6's new state fields (boss HP, wormhole state, arena state)

### Preparation Needed (Nice-to-have)

- Commit Epic 5 work cleanly to git

### Epic 6 Scope (Tier 2: Boss Encounters & System Completion)

| Story | Title | Key Challenge |
|-------|-------|---------------|
| 6.1 | Wormhole Discovery & Activation | Shockwave clearing all enemies, transition to boss phase |
| 6.2 | Boss Arena & Combat | First isolated scene (BossScene.jsx), telegraphed attack patterns, boss AI |
| 6.3 | Boss Defeat & System Completion | Victory/tunnel branching, Fragment rewards, system completion logic |

### Risks for Epic 6

| Risk | Mitigation |
|------|------------|
| First isolated scene (BossScene) — new architectural pattern | Clear separation from GameplayScene, reuse existing renderer patterns |
| Boss AI with telegraphed attacks — new complexity | Start simple (1-2 attack patterns), iterate |
| Complex phase transitions (gameplay → boss → victory/tunnel) | fadingRef guard pattern established, automated reset tests as safety net |
| Enemy clear shockwave could leave orphaned state | Fix `4-7` first, reset tests catch missed state |

### Verdict

**READY TO START EPIC 6** — After fixing `4-7` and adding automated reset tests.

## Next Steps

1. Fix `4-7-bugfix-reset-enemies-on-retry` (BLOCKING)
2. Add automated `reset()` coverage tests for all Zustand stores
3. Commit Epic 5 work to git
4. Mark `epic-5` as "done" and `epic-5-retrospective` as "done" in sprint-status
5. Start creating Epic 6 stories with `create-story`
