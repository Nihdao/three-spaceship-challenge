# Retrospective — Epic 1: Ship Flight & Space Environment

**Date:** 2026-02-07
**Facilitator:** Bob (Scrum Master)
**Epic Status:** Complete (3/3 stories done)
**Participants:** Adam (Project Lead), Alice (Product Owner), Bob (Scrum Master), Charlie (Senior Dev), Dana (QA Engineer), Elena (Junior Dev)

## Epic 1 Summary

### Delivery Metrics

- Stories Completed: 3/3 (100%)
- Code Reviews Completed: 3/3
- Total Review Findings: ~20 (6 HIGH, 12 MEDIUM, 4 LOW)
- Findings Fixed: ~16/20 (80%)
- Findings Accepted (intentional): 4
- Production Incidents: 0

### Stories Delivered

| Story | Title | Agent | Key Outcome |
|-------|-------|-------|-------------|
| 1.1 | Project Foundation & Architecture Setup | Claude Opus 4.6 | Project restructured from fish-tank to spaceship game. 13 tasks, Tailwind v4, GameLoop skeleton, stores, entity defs, scene routing |
| 1.2 | Ship Movement, Rotation & Banking | Claude Opus 4.6 | Full movement system: acceleration/deceleration, yaw rotation, banking, boundary clamping, top-down camera follow |
| 1.3 | Space Environment & Boundaries | Claude Opus 4.6 | Starfield (4000 stars), boundary walls with proximity opacity, ground plane, camera far plane update, PLAY_AREA_SIZE 200→2000 |

## What Went Well

1. **Pipeline story → dev → review well-established** — High velocity, clear process, each story built on the previous one
2. **Store-based tick pattern validated** — Logic in usePlayer.tick(), renderers read-only. Established in Story 1.2, confirmed in Story 1.3 (zero store changes needed)
3. **Code reviews effective** — Caught real bugs: SFX memory leak (1.1), frame-rate dependent camera lerp (1.2), geometry disposal (1.3)
4. **Detailed story files = faster execution** — Technical context, architecture references, and "Previous Story Intelligence" sections reduced ambiguity and prevented mistakes
5. **Tailwind v4 positive deviation** — Simpler setup via @tailwindcss/vite vs planned v3 PostCSS approach
6. **Overall assessment from Adam: "Cool, fast, and it works"**

## Challenges

1. **R3F v9 runtime gotchas** — Declarative `<bufferAttribute>` didn't work (Story 1.3), switched to imperative. `sizeAttenuation` made stars invisible at distance. These are discovered at runtime, impossible to predict in story files
2. **Ship model orientation** — Spaceship.glb "front" didn't align with -Z in local space, causing incorrect yaw rotation (Story 1.2). Classic GLB export convention mismatch
3. **Hardcoded constants** — Flagged in 2/3 story reviews. Dev agent should put all tunable values in gameConfig.js from the start
4. **Memory management not systematic** — SFX Howl leak (1.1), BufferGeometry disposal (1.3). WebGL memory management needs to be a reflex, not a review afterthought
5. **~2 HIGH findings per story** — Reviews catch them, but ideally fewer at source

## Key Insights

1. **Story file quality directly impacts velocity** — Detailed technical context, architecture references, and previous story learnings enable fast, accurate implementation
2. **Store-based tick is the correct pattern** — Validated across 2 stories, should be replicated for all Epic 2 entities (enemies, weapons, projectiles)
3. **R3F v9 declarative API is unreliable for custom geometries** — Prefer imperative approach (useMemo + setAttribute) for BufferGeometry
4. **Three conventions to enforce in Epic 2:** all constants in gameConfig, memory cleanup checklist, model orientation convention (-Z forward)

## Technical Debt

| Item | Severity | Impact on Epic 2 | Action |
|------|----------|-------------------|--------|
| Rapier installed but unused | LOW | No impact — not blocking. Bundle size only | Decision: keep for Tier 2/3 visual physics or remove to reduce bundle (Adam's call) |
| No unit tests for Story 1.1 | LOW | No impact — scaffolding story with no testable logic | Accepted |
| Position as plain array [0,0,0] | LOW | No impact — consistent with store pattern, performant | Accepted |

## Action Items

### Process Improvements

| # | Action | Owner | Success Criteria |
|---|--------|-------|------------------|
| 1 | Document 3D model orientation convention: all GLB models must point -Z forward in local space. Apply rotation at load time if needed | Dev agent (Story 2.2) | Convention applied and documented in dev notes |
| 2 | All tunable values in gameConfig.js from the start — no hardcoding | Dev agent + Code reviewer | 0 "hardcoded constant" findings in Epic 2 reviews |
| 3 | Memory management checklist: dispose() geometries/materials, useEffect cleanup for imperative resources, unload audio assets | Dev agent + Code reviewer | 0 memory leak findings in Epic 2 reviews |

### Epic Status Update

| Action | Details |
|--------|---------|
| Mark epic-1 as "done" | All 3 stories complete, retrospective done |
| Mark epic-1-retrospective as "done" | This retrospective |

## Epic 2 Readiness Assessment

### Dependencies on Epic 1 — All Met

- ✅ GameLoop with tick order (steps 3-9 commented, ready to activate)
- ✅ Entity definition skeletons (LASER_FRONT, FODDER_BASIC)
- ✅ Stores useEnemies/useWeapons with empty tick() methods
- ✅ Config pattern and PLAY_AREA_SIZE calibrated (2000)
- ✅ GameplayScene ready to receive new renderers
- ✅ 6-layer architecture established and validated

### Preparation Needed

- **No critical prep sprint required** — Epic 1 foundation covers all Epic 2 dependencies
- **No blocking technical debt** — All debt items are LOW priority
- **No significant discoveries** that change Epic 2 plan

### Risks for Epic 2

| Risk | Mitigation |
|------|------------|
| InstancedMesh + typed arrays (new pattern) | Story 2.2 specifically tackles this. Refer to architecture doc patterns |
| R3F v9 gotchas with InstancedMesh | Prefer imperative approach if declarative fails (lesson from Epic 1) |
| Performance with 100+ entities | Spatial hashing (Story 2.1) + InstancedMesh (Story 2.2) designed for this. Test early |
| Enemy model orientation | Apply new convention from Action Item #1 |

### Verdict

**READY TO START EPIC 2** — No blockers, no prep sprint needed, foundation solid.

## Next Steps

1. Mark epic-1 as "done" and epic-1-retrospective as "done" in sprint-status.yaml
2. Start creating Epic 2 stories with `create-story`
3. Apply the 3 process improvement conventions from this retrospective
4. Epic 2 will auto-transition to "in-progress" when first story is created
